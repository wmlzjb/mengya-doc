webpackJsonp([17],{"78Xa":function(s,a,t){s.exports=t("nhJZ")},nhJZ:function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},n=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h2",{attrs:{id:"jiao-se-he-zi-yuan"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jiao-se-he-zi-yuan","aria-hidden":"true"}},[s._v("¶")]),s._v(" 角色和资源")]),s._v(" "),t("p",[s._v("框架中中除了基本的基础设施类之外，还完整实现了“权限模块”，涉及到的概念有角色、资源，和令牌授权一样，开发人员只需要了解基本流程和怎么使用即可。"),t("br")]),s._v(" "),t("h3",{attrs:{id:"jiao-se-zi-yuan-yong-hu-jian-de-guan-xi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jiao-se-zi-yuan-yong-hu-jian-de-guan-xi","aria-hidden":"true"}},[s._v("¶")]),s._v(" 角色、资源、用户间的关系")]),s._v(" "),t("div",{staticClass:"tip"},[t("p",[s._v("1 一个用户可以属于一个角色（一对一）"),t("br")]),s._v(" "),t("p",[s._v("2 一个角色可以有多个资源，资源也可以同时属于多个角色（多对多）"),t("br")]),s._v(" "),t("p",[s._v("3 资源以Code（编码）为关键字段，在具体的API将Code硬编码至指定Action的"),t("strong",[s._v("Resources")]),s._v("拦截器中，以实现权限控制"),t("br")])]),s._v(" "),t("h3",{attrs:{id:"zi-yuan-lan-jie-qi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zi-yuan-lan-jie-qi","aria-hidden":"true"}},[s._v("¶")]),s._v(" 资源拦截器")]),s._v(" "),t("p",[s._v("资源拦截器基本实现逻辑是在客户端发情Request请求，并进入API Action主体代码块之前，拦截掉请求，优先进入到拦截器的代码中，而代码中将解析客户端请求头中包含的Token，并解析成用户操作对象，然后在数据库中根据对象的角色，查询其对象是否拥有构造方法中传入的资源Code，如果存在，则代表允许继续请求Action，否者抛出异常。"),t("br")]),s._v(" "),t("p",[s._v("资源Code拦截示例")]),s._v(" "),t("pre",{pre:!0},[t("code",{attrs:{class:"hljs language-csharp"}},[t("span",{attrs:{class:"hljs-comment"}},[t("span",{attrs:{class:"hljs-doctag"}},[s._v("///")]),s._v(" "),t("span",{attrs:{class:"hljs-doctag"}},[s._v("<summary>")])]),s._v("\n"),t("span",{attrs:{class:"hljs-comment"}},[t("span",{attrs:{class:"hljs-doctag"}},[s._v("///")]),s._v("  根据Id获取会员")]),s._v("\n"),t("span",{attrs:{class:"hljs-comment"}},[t("span",{attrs:{class:"hljs-doctag"}},[s._v("///")]),s._v(" "),t("span",{attrs:{class:"hljs-doctag"}},[s._v("</summary>")])]),s._v("\n"),t("span",{attrs:{class:"hljs-comment"}},[t("span",{attrs:{class:"hljs-doctag"}},[s._v("///")]),s._v(" "),t("span",{attrs:{class:"hljs-doctag"}},[s._v('<param name="id">')]),t("span",{attrs:{class:"hljs-doctag"}},[s._v("</param>")])]),s._v("\n"),t("span",{attrs:{class:"hljs-comment"}},[t("span",{attrs:{class:"hljs-doctag"}},[s._v("///")]),s._v(" "),t("span",{attrs:{class:"hljs-doctag"}},[s._v('<param name="options">')]),t("span",{attrs:{class:"hljs-doctag"}},[s._v("</param>")])]),s._v("\n"),t("span",{attrs:{class:"hljs-comment"}},[t("span",{attrs:{class:"hljs-doctag"}},[s._v("///")]),s._v(" "),t("span",{attrs:{class:"hljs-doctag"}},[s._v("<returns>")]),t("span",{attrs:{class:"hljs-doctag"}},[s._v("</returns>")])]),s._v("\n["),t("span",{attrs:{class:"hljs-meta"}},[s._v("Route("),t("span",{attrs:{class:"hljs-meta-string"}},[s._v('"{id}"')]),s._v(", Name = "),t("span",{attrs:{class:"hljs-meta-string"}},[s._v('"GetMember"')]),s._v(")")]),s._v("]\n["),t("span",{attrs:{class:"hljs-meta"}},[s._v("Resources("),t("span",{attrs:{class:"hljs-meta-string"}},[s._v('"View_Member"')]),s._v(")")]),s._v("]"),t("span",{attrs:{class:"hljs-comment"}},[s._v("//资源拦截器，其中的View_Member就是资源Code")]),s._v("\n"),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("public")]),s._v(" "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("override")]),s._v(" IHttpActionResult "),t("span",{attrs:{class:"hljs-title"}},[s._v("Get")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("string")]),s._v(" id, ODataQueryOptions<MemberViewModel> options")]),s._v(")\n")]),s._v("{\n    ......\n}\n")])]),s._v(" "),t("div",{staticClass:"tip"},[t("p",[s._v("除了对单个资源Code进行拦截，目前也支持 ‘and’ 和 ‘or’ 语法来拦截，示例："),t("br")]),s._v(" "),t("pre",{pre:!0},[t("code",{attrs:{class:"hljs language-csharp"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("//允许若干个资源Code进行and组合，需要所有资源Code全部命中，就算允许通过")]),s._v("\n["),t("span",{attrs:{class:"hljs-meta"}},[s._v("Resources("),t("span",{attrs:{class:"hljs-meta-string"}},[s._v('"View_Member and View_List and View_Info"')]),s._v(")")]),s._v("] \n")])]),s._v(" "),t("pre",{pre:!0},[t("code",{attrs:{class:"hljs language-csharp"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("//允许若干个资源Code进行or组合，只要其中有一个资源Code命中，就算允许通过")]),s._v("\n["),t("span",{attrs:{class:"hljs-meta"}},[s._v("Resources("),t("span",{attrs:{class:"hljs-meta-string"}},[s._v('"View_Member or View_List or View_Info"')]),s._v(")")]),s._v("]\n")])]),s._v(" "),t("pre",{pre:!0},[t("code",{attrs:{class:"hljs language-csharp"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("//注意！暂时不支持下面这种and和or同时组合的情况")]),s._v("\n["),t("span",{attrs:{class:"hljs-meta"}},[s._v("Resources("),t("span",{attrs:{class:"hljs-meta-string"}},[s._v('"View_Member or View_List and View_Info"')]),s._v(")")]),s._v("]\n")])])])])}],r=t("XyMi"),l=null,_=!1,c=null,v=null,o=null,i=Object(r["a"])(l,e,n,_,c,v,o);a["default"]=i.exports}});
//# sourceMappingURL=17.99024f65.js.map