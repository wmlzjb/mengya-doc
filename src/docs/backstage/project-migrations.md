## 数据库迁移

上述项目配置完成后，需要对项目所涉及的**Skyline.CA**、**Skyline.DB**两个数据库进行初始化，框架数据底层是基于EF 6.1.3的Code First模式，在建立好相应的实体之后，只需要执行一下迁移语句即可自动生成数据库和相关表结构，而项目运行所需的初始化数据，也通过编写代码的方式存放于**Skyline.Businsess**项目中**Migrations**目录下的**Configuration.cs**文件中，执行迁移会自动将这些数据插入到数据库中。<br>

其中DB数据库迁移情况可能出现下列三种情况：

:::tip
情况一<br>
DB数据库如果是在没有数据库的情况下第一次执行迁移创建，请在**Skyline.Web.CA**项目配置中间中将**IsMigrations**配置改为true，并按下列步骤进行迁移。
:::

:::tip
情况二<br>
DB数据库如果是在有数据库的情况下希望删除重新执行迁移创建，请先手动删除现有DB数据库，并在**Skyline.Web.CA**项目配置中间中将**IsMigrations**配置改为true，并按下列步骤进行迁移。
:::

:::tip
情况三<br>
DB数据库如果是在有数据库的情况下**增量**执行迁移创建，请在**Skyline.Web.CA**项目配置中间中将**IsMigrations**配置改为false，并按下列步骤进行迁移。<br>
:::


### CA数据库的迁移步骤

:::tip

1 将**Skyline.Web.CA**项目右键**设为启动项目**<br>

2 在VS顶部菜单中依次选择**工具** / **Nuget包管理器** / **程序包管理器控制台**<br>

3 在VS底部出现的**程序包管理器控制台**中的**默认项目**下拉框中选择**Skyline.Web.CA**<br>

4 在控制台中按回车，等到出现**PM>**后，输入**Add-Migration MyInitCA**并按回车，其中**MyInitCA**是代表本次迁移的名字，可以自定义输入自己想要的<br>

5 等待执行完成后，结果中也许会出现黄色的警告，可以忽视，同时会在**Skyline.Web.CA**项目中**Migrations**目录下创建一个**时间+迁移名称的.cs**文件，里面就包含着本次迁移的脚本<br>

6 当出现这个文件后，再次在控制台的**PM>**后，输入**Update-Database**并按回车，这个指定代表着确认执行当前的迁移脚本，并同步到数据库，这个过程因为会插入初始化数据，所以需要的时间大概会有几分钟，直到再次出现**PM>**，则代表迁移成功<br>

:::


### DB数据库的迁移步骤

:::tip

1 将**Skyline.Web.CA**项目右键**设为启动项目**<br>

2 在VS顶部菜单中依次选择**工具** / **Nuget包管理器** / **程序包管理器控制台**<br>

3 在VS底部出现的**程序包管理器控制台**中的**默认项目**下拉框中选择**Skyline.Businsess**<br>

4 在控制台中按回车，等到出现**PM>**后，输入**Add-Migration MyInitDB**并按回车，其中**MyInitDB**是代表本次迁移的名字，可以自定义输入自己想要的<br>

5 等待执行完成后，结果中也许会出现黄色的警告，可以忽视，同时会在**Skyline.Web.Businsess**项目中**Migrations**目录下创建一个**时间+迁移名称的.cs**文件，里面就包含着本次迁移的脚本<br>

6 当出现这个文件后，再次在控制台的**PM>**后，输入**Update-Database**并按回车，这个指定代表着确认执行当前的迁移脚本，并同步到数据库，这个过程因为会插入初始化数据，所以需要的时间大概会有几分钟，直到再次出现**PM>**，则代表迁移成功<br>

:::

:::tip
PS. 两个数据库的迁移可以分别、单独执行，但是项目第一次运行或者删库重来的情况下，请遵照先CA后DB的顺序执行迁移。
:::